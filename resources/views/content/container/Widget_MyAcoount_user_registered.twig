<h2>Bonusprogramm (my account page)</h2>

<style>

    .label {
        background-color: #fff;
        text-align: left;
        color: #000;
        display: inline-block;
        cursor: pointer;
    }

    div.widget-myaccount{
        margin-top: 15px;
        margin-bottom: 15px;
        border: 1px solid #666;
        padding: 5px;
    }
    .checkbox:checked:before{
        background-color:red;
    }

</style>

<div class = "widget-myaccount">
    <label class="label">
        <input id="yes_unregistered_loyalista_programme" type="checkbox" value="text"> {{ disclaimer }}
    </label>
    <button class="btn  btn-primary btn-appearance" onclick="myFunction(this)"> {{ btn_label }}</button>
</div>

<script>
    function myFunction(_obj) {

        $(_obj).attr('disabled' , true);

        let checked = $('#yes_unregistered_loyalista_programme').is(":checked");

        if(!checked){
            $(_obj).attr('disabled' , false);
            return false;
        }

        $.ajax({
            url: '/account/unregister/customer/',
            type: "GET",
            data: {},
            dataType: "json",
            cache: true
        }).done(function (return_data) {
            try {

                var data;

                if (typeof return_data === 'object') data = return_data;
                else data = $.parseJSON(return_data);

                if (data.status === "OK") {
                    location.reload();
                    console.log('done');
                } else {
                    $(_obj).attr('disabled' , false);
                    alert(data.message);
                }
            } catch (error) {
                $(_obj).attr('disabled' , false);
                console.log(error);
            }

        }).fail(function (data) {
            $(_obj).attr('disabled' , false);

        });




    }

</script>