<style>
    .label {
        background-color: #fff;
        text-align: left;
        color: #000;
        display: inline-block;
        cursor: pointer;
    }
    div.widget-checkout-widget_wrapper_loyalista{
        margin-top: 15px;
        margin-bottom: 15px;
        border: 1px solid #666 !important;
        padding: 5px;
    }
</style>

<div class="widget_wrapper_loyalista" style="">
    <h2>Bonusprogramm checkout</h2>
    <div class = "widget-checkout-widget_wrapper_loyalista">
        <span>{{ content_1 | raw }}</span><br /><hr />
        <label class="label">
           <input name="widget_chekcout__options" id="" type="radio" value="text" checked> {{ content_2 }}
        </label>
        <label class="label">
            <input name="widget_chekcout__options" id="" type="radio" value="text"> {{ content_3 }}
        </label>
        <label class="label">
            <div class="pluginfy_checkout_cart_contents_wrapper">
                <input name="widget_chekcout__options" id="" type="radio" value="text">
                {{ content_4 }} <input type="text" name="" id="">
            </div>
        </label>
    </div>
</div>

<script>

    function setCoPointBait(){

        let target_span = $('div.widget-checkout-widget_wrapper_loyalista').find('span.loyalista_co_num_of_points');

        $.ajax({
            url: '/user/total/basket/',
            type: "GET",
            data: {},
            dataType: "json",
            cache: true
        }).done(function (return_data) {
            try {

                var data;
                if (typeof return_data === 'object') data = return_data;
                else data = $.parseJSON(return_data);

                if (data.status === "OK") {

                    let basket_total = data.basket_total;
                    let conversion = target_span.data('revenue_to_point');

                    let points = ( basket_total /  conversion );
                    target_span.html(points);

                } else {
                    $(_obj).attr('disabled' , false);
                    alert(data.message);
                }
            } catch (error) {
                console.log(error);
                $(_obj).attr('disabled' , false);
            }
        }).fail(function (data) {
            $(_obj).attr('disabled' , false);
        });
    }




    $(function(){
        $('.totalSum dd[data-testing="basket-amount"]').bind('DOMSubtreeModified', function(){
            setCoPointBait();
        });

    });


</script>
